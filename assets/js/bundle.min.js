function setActiveNav(){var e=location.pathname.split("/").pop(),e=document.getElementById({"index.html":"nav-home","recipe-recommender.html":"nav-sdg2","mood-journal.html":"nav-sdg3","study-buddy.html":"nav-sdg4"}[e]||"nav-home");e&&e.classList.add("active")}document.addEventListener("DOMContentLoaded",setActiveNav);let API_BASE="http://localhost:5000",MAX_RETRIES=2,RETRY_DELAY=1e3;async function apiCall(e,t,n=null,a=0){try{var r,o={method:e.toUpperCase(),headers:{"Content-Type":"application/json"}},i=(!n||"POST"!==e&&"PUT"!==e&&"PATCH"!==e||(o.body=JSON.stringify(n)),await fetch(""+API_BASE+t,o));if(i.ok)return(r=i.headers.get("content-type"))&&r.includes("application/json")?await i.json():await i.text();var s=await i.text(),d=new Error(`API Error (${i.status}): `+s);if((500<=i.status||0===i.status)&&a<MAX_RETRIES)return console.warn(`Retrying API call (${a+1}/${MAX_RETRIES})...`),await new Promise(e=>setTimeout(e,RETRY_DELAY*(a+1))),await apiCall(e,t,n,a+1);throw d}catch(e){throw console.error("API Call Failed:",e),(e.message.includes("Failed to fetch")||e.message.includes("NetworkError"))&&console.warn("Backend server may not be running. Using fallback data."),e}}async function apiGet(e){return apiCall("GET",e)}async function apiPost(e,t){return apiCall("POST",e,t)}async function apiPut(e,t){return apiCall("PUT",e,t)}async function apiDelete(e){return apiCall("DELETE",e)}function showLoading(e,t="Loading..."){let n=e.textContent;return e.textContent=t,e.disabled=!0,()=>{e.textContent=n,e.disabled=!1}}function showError(t,n=null){if(console.error("Error:",t),n){let e=document.createElement("div");e.className="error-message",e.textContent=t,e.style.cssText="color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 4px; margin: 10px 0;",n.prepend(e),setTimeout(()=>e.remove(),5e3)}else alert("Error: "+t)}function toggleLearnMore(){var e=document.getElementById("learn-more-btn"),t=document.getElementById("learn-more-content");e&&t&&("true"===e.getAttribute("aria-expanded")?(t.style.display="none",t.setAttribute("aria-hidden","true"),e.setAttribute("aria-expanded","false"),e.innerHTML="Learn More ⌄"):(t.style.display="block",t.setAttribute("aria-hidden","false"),e.setAttribute("aria-expanded","true"),e.innerHTML="Show Less ⌃",t.scrollIntoView({behavior:"smooth",block:"nearest"})))}function initLearnMore(){var e=document.getElementById("learn-more-btn"),t=document.getElementById("learn-more-content");e&&t&&(e.addEventListener("click",toggleLearnMore),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),toggleLearnMore())}))}window.addEventListener("pagehide",function(e){e.persisted}),document.addEventListener("DOMContentLoaded",()=>{initLearnMore()}),document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("menu-toggle"),n=document.getElementById("nav-menu");t&&n&&(t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","nav-menu"),t.setAttribute("aria-label","Toggle navigation menu"),t.addEventListener("click",()=>{var e="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",!e),n.classList.toggle("show"),e||setTimeout(()=>{var e=n.querySelector("a");e&&e.focus()},100)}),n.querySelectorAll("a").forEach(e=>e.addEventListener("click",()=>{n.classList.remove("show"),t.setAttribute("aria-expanded","false")})),document.addEventListener("click",e=>{!n.classList.contains("show")||n.contains(e.target)||t.contains(e.target)||(n.classList.remove("show"),t.setAttribute("aria-expanded","false"))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&n.classList.contains("show")&&(n.classList.remove("show"),t.setAttribute("aria-expanded","false"),t.focus())}))});